/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.0/samples
 */
apply plugin: 'java'
apply plugin: 'war'
apply plugin: 'org.gretty'

targetCompatibility = 1.16
sourceCompatibility = 1.16

buildscript {

    repositories {
        mavenCentral()
        maven { url "https://plugins.gradle.org/m2/" }
    }

    dependencies {
        classpath 'org.gretty:gretty:+'
    }
}

repositories {
    mavenCentral()
}

configurations {
    jakartaMigration
}

dependencies {
    implementation "org.glassfish.jersey.core:jersey-server:3.0.3"
    implementation "org.glassfish.jersey.inject:jersey-hk2:3.0.3"
    implementation "org.glassfish.jersey.containers:jersey-container-servlet:3.0.3"
    implementation "org.glassfish.jersey.media:jersey-media-multipart:3.0.3"

    implementation group: 'org.keycloak', name: 'keycloak-servlet-filter-adapter', version: '15.0.2'

    jakartaMigration group: 'org.apache.tomcat', name: 'jakartaee-migration', version: '1.0.0'

    gretty group: 'org.apache.tomcat', name: 'jakartaee-migration', version: '1.0.0'
}

task migrateJakarta {
    doLast {
        println('Migrating classes to jakarta: '+war.archivePath)
        ant.taskdef(name: 'migrateJakarta',
                classname: 'org.apache.tomcat.jakartaee.MigrationTask',
                classpath: configurations.jakartaMigration.asPath)
        ant.migrateJakarta(src: war.archivePath,
                dest: war.archivePath,
                profile: 'tomcat') {
        }
    }
}

war {
    archiveFileName = "ROOT.war"
    finalizedBy migrateJakarta
}

// Used for running a local server
// cmd: gradle appRun
//  or: gradle appRunDebug
gretty {
    httpPort = 8080
    servletContainer = 'tomcat10'
    contextPath = '/'
}

